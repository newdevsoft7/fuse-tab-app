<div class="users-wrapper">

    <!-- HEADER -->
    <div class="header p-16 p-sm-24" fxLayout="column">

        <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutWrap class="action-btns">
            <div>
                <button mat-raised-button class="my-12" color="accent">
                    <div fxLayout="row" fxLayoutAlign="start center">
                        <mat-icon>mail</mat-icon>
                        <span>New Message</span>
                    </div>
                </button>

                <button mat-raised-button class="my-12" color="accent">
                    <div fxLayout="row" fxLayoutAlign="start center">
                        <mat-icon>assignment</mat-icon>
                        <span>Assign Reports</span>
                    </div>
                </button>

                <button mat-raised-button class="my-12" color="accent">
                    <div fxLayout="row" fxLayoutAlign="start center">
                        <mat-icon>add_to_photos</mat-icon>
                        <span>Export</span>
                    </div>
                </button>

                <button mat-raised-button class="my-12" color="accent">
                    <div fxLayout="row" fxLayoutAlign="start center">
                        <mat-icon>contact_mail</mat-icon>
                        <span>Email Showcase</span>
                    </div>
                </button>

                <button mat-raised-button class="my-12" color="accent">
                    <div fxLayout="row" fxLayoutAlign="start center">
                        <mat-icon>contact_mail</mat-icon>
                        <span>Add to presentation</span>
                    </div>
                </button>

                <button mat-raised-button class="my-12" color="accent">
                    <div fxLayout="row" fxLayoutAlign="start center">
                        <mat-icon>perm_contact_calendar</mat-icon>
                        <span>Add to submission</span>
                    </div>
                </button>

            </div>


            <!-- SEARCH -->
            <div class="search-input-wrapper mt-16 ml-8 m-sm-0" fxLayout="row" fxLayoutAlign="start center">
                <label for="search" class="mr-8">
                    <mat-icon>search</mat-icon>
                </label>
                <mat-form-field mat-no-float class="m-0" floatPlaceholder="never">
                    <input matInput id="search" #searchInput placeholder="Search for anything" (keyup)='updateFilter(searchInput.value)'>
                </mat-form-field>
            </div>
            <!-- / SEARCH -->

        </div>

        <div>
            <app-users-search-bar (onSearchChipsChange)="onSearchChipsChange($event)"></app-users-search-bar>
        </div>
    </div>
    <!-- / HEADER -->

    <!-- CONTENT -->
    <div class="content p-24 pb-56 pr-sm-92 ps ps--active-y">

        <!-- TABLE -->
        <div *ngIf="filteredUsers" class="users-table">

            <ngx-datatable
                #table
                class="material striped"
                [rows]="filteredUsers"
                [loadingIndicator]="loadingIndicator"
                [columnMode]="'force'"
                [headerHeight]="48"
                [footerHeight]="56"
                [rowHeight]="'auto'"
                [scrollbarH]="true"
                [selectionType]="'checkbox'"
                [selectAllRowsOnPage]="true"
                [selected]="selectedUsers"
                [reorderable]="reorderable"
                [limit]="10"
                (select)="onSelect($event)"
                (activate)="onActivate($event)">

                <ngx-datatable-column
                    [width]="50"
                    [sortable]="false"
                    [canAutoResize]="false"
                    [draggable]="false"
                    [resizeable]="false"
                    [headerCheckboxable]="true">

                    <ng-template ngx-datatable-header-template
                                 let-value="value"
                                 let-allRowsSelected="allRowsSelected"
                                 let-selectFn="selectFn">
                        <mat-checkbox [checked]="allRowsSelected" (change)="selectFn(!allRowsSelected)"></mat-checkbox>
                    </ng-template>
                    
                    <ng-template ngx-datatable-cell-template
                                 let-value="value"
                                 let-isSelected="isSelected"
                                 let-onCheckboxChangeFn="onCheckboxChangeFn">
                        <mat-checkbox [checked]="isSelected" (change)="onCheckboxChangeFn($event)"></mat-checkbox>
                    </ng-template>
                </ngx-datatable-column>

                <ng-container *ngFor="let column of columns">

                    <ngx-datatable-column
                        *ngIf="!['id', 'ppic_a', 'fav'].includes(column.key_name)"
                        name="{{column.display_name}}"
                        prop="{{column.key_name}}"
                        >
                    </ngx-datatable-column>

                    <ngx-datatable-column
                        *ngIf="column.key_name == 'ppic_a'"
                        name="{{column.display_name}}"
                        prop="{{column.key_name}}"
                        [width]="100"
                        [sortable]="false"
                        [canAutoResize]="false">
                        <ng-template *ngIf="column.key_name == 'ppic_a'" let-row="row" let-value="value" ngx-datatable-cell-template>
                            <img class="avatar" [src]="getAvatar(value)" (click)="openUserTab(row, $event)" />
                        </ng-template>
                    </ngx-datatable-column>

                    <ngx-datatable-column
                        *ngIf="column.key_name == 'fav'"
                        name="{{column.display_name}}"
                        prop="{{column.key_name}}"
                        [width]="100"
                        [canAutoResize]="false">
                        
                        <ng-template *ngIf="column.key_name =='fav'" let-row="row" let-value="value" ngx-datatable-cell-template>

                            <div class="" fxLayout="row" fxLayoutAlign="start center">

                                <button mat-icon-button (click)="toggleFav(row, $event)">
                                    <mat-icon [class.amber-600-fg]="value == 1">star</mat-icon>
                                </button>

                            </div>

                        </ng-template>

                    </ngx-datatable-column>

                </ng-container>

                <ngx-datatable-column 
                    [width]="100"
                    [sortable]="false"
                    [resizeable]="false"
                    [draggable]="false"
                    [canAutoResize]="false">
                    
                    <ng-template let-row="row" ngx-datatable-cell-template>
                        
                        <button mat-icon-button [matMenuTriggerFor]="menu" class="more-vert">
                            <mat-icon class="material-icons">more_horiz</mat-icon>
                        </button>
                        
                        <mat-menu #menu="matMenu">

                            <button mat-menu-item>
                                <mat-icon>vpn_key</mat-icon>
                                <span>Login as user</span>
                            </button>

                            <button mat-menu-item [matMenuTriggerFor]="typeMenu">
                                <mat-icon>shuffle</mat-icon>
                                <span>Change type</span>
                            </button>

                            <button mat-menu-item>
                                <mat-icon>vpn_key</mat-icon>
                                <span>Change password</span>
                            </button>

                        </mat-menu>
            
                        <mat-menu #typeMenu="matMenu">

                            <button mat-menu-item>Owner</button>
                            <button mat-menu-item>Administrator</button>
                            <button mat-menu-item>Supervisor</button>
                            <button mat-menu-item>Staff</button>
                            <button mat-menu-item>Inactive</button>
                            <button mat-menu-item>Blacklisted</button>

                        </mat-menu>

                    </ng-template>

                </ngx-datatable-column>

            </ngx-datatable>

        </div>
        <!-- / TABLE -->

        <!-- ADD USER BUTTON -->
        <button mat-fab class="mat-accent-bg" id="add-user-button" aria-label="add user" (click)="openNewUser()">
            <mat-icon>person_add</mat-icon>
        </button>
        <!-- / ADD USER BUTTON -->
    </div>
    <!-- CONTENT -->
</div>
